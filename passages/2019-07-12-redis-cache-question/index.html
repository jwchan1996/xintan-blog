<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redis热key,缓存穿透,击穿,集群等问题研究 | 心谭博客</title>
    <meta name="description" content="专注前端方向与可视化领域的博客">
    
    
    <link rel="preload" href="/assets/css/0.styles.42373c9e.css" as="style"><link rel="preload" href="/assets/js/app.9d47bfcf.js" as="script"><link rel="preload" href="/assets/js/2.f2881f60.js" as="script"><link rel="preload" href="/assets/js/127.5e49c169.js" as="script"><link rel="preload" href="/assets/js/4.6561383e.js" as="script"><link rel="prefetch" href="/assets/js/10.41dbd96c.js"><link rel="prefetch" href="/assets/js/100.6a22a43b.js"><link rel="prefetch" href="/assets/js/101.4c2772ce.js"><link rel="prefetch" href="/assets/js/102.dd43ddb2.js"><link rel="prefetch" href="/assets/js/103.89c682e8.js"><link rel="prefetch" href="/assets/js/104.f41e3837.js"><link rel="prefetch" href="/assets/js/105.41f77b62.js"><link rel="prefetch" href="/assets/js/106.3fc0a1f1.js"><link rel="prefetch" href="/assets/js/107.83aed4aa.js"><link rel="prefetch" href="/assets/js/108.6bcf1f4c.js"><link rel="prefetch" href="/assets/js/109.5d9ea512.js"><link rel="prefetch" href="/assets/js/11.59051f17.js"><link rel="prefetch" href="/assets/js/110.59622260.js"><link rel="prefetch" href="/assets/js/111.82aacd80.js"><link rel="prefetch" href="/assets/js/112.b8a6834d.js"><link rel="prefetch" href="/assets/js/113.bc961dc5.js"><link rel="prefetch" href="/assets/js/114.d91c2b3d.js"><link rel="prefetch" href="/assets/js/115.d1d9c73c.js"><link rel="prefetch" href="/assets/js/116.a7bbc54c.js"><link rel="prefetch" href="/assets/js/117.0f6bac51.js"><link rel="prefetch" href="/assets/js/118.22019263.js"><link rel="prefetch" href="/assets/js/119.256a8727.js"><link rel="prefetch" href="/assets/js/12.228741a5.js"><link rel="prefetch" href="/assets/js/120.363f8c8e.js"><link rel="prefetch" href="/assets/js/121.e136467b.js"><link rel="prefetch" href="/assets/js/122.c9e7c5da.js"><link rel="prefetch" href="/assets/js/123.11e9bcd8.js"><link rel="prefetch" href="/assets/js/124.b476d09d.js"><link rel="prefetch" href="/assets/js/125.6ad01b54.js"><link rel="prefetch" href="/assets/js/126.8f53687a.js"><link rel="prefetch" href="/assets/js/128.11614fd9.js"><link rel="prefetch" href="/assets/js/129.e0e77449.js"><link rel="prefetch" href="/assets/js/13.1e8df012.js"><link rel="prefetch" href="/assets/js/130.53aabc7b.js"><link rel="prefetch" href="/assets/js/131.3b916617.js"><link rel="prefetch" href="/assets/js/132.c046a2c4.js"><link rel="prefetch" href="/assets/js/133.d0264147.js"><link rel="prefetch" href="/assets/js/134.b3e5ffdc.js"><link rel="prefetch" href="/assets/js/135.46286965.js"><link rel="prefetch" href="/assets/js/136.b8d3df9f.js"><link rel="prefetch" href="/assets/js/137.53fc330b.js"><link rel="prefetch" href="/assets/js/138.a9174b9e.js"><link rel="prefetch" href="/assets/js/139.2ca5361c.js"><link rel="prefetch" href="/assets/js/14.febfef5a.js"><link rel="prefetch" href="/assets/js/140.f798ae25.js"><link rel="prefetch" href="/assets/js/141.8a6e36fd.js"><link rel="prefetch" href="/assets/js/142.8fb39d68.js"><link rel="prefetch" href="/assets/js/143.62c1d509.js"><link rel="prefetch" href="/assets/js/144.a052aa7c.js"><link rel="prefetch" href="/assets/js/145.7546262a.js"><link rel="prefetch" href="/assets/js/146.d316f522.js"><link rel="prefetch" href="/assets/js/147.ba4b6b6a.js"><link rel="prefetch" href="/assets/js/148.6a109d2a.js"><link rel="prefetch" href="/assets/js/149.7c0632c5.js"><link rel="prefetch" href="/assets/js/15.ec15ac92.js"><link rel="prefetch" href="/assets/js/150.45b46d44.js"><link rel="prefetch" href="/assets/js/151.d104651d.js"><link rel="prefetch" href="/assets/js/152.4f2c4d2c.js"><link rel="prefetch" href="/assets/js/153.b66ed7a0.js"><link rel="prefetch" href="/assets/js/154.7f4f8cd5.js"><link rel="prefetch" href="/assets/js/155.cdaf5c57.js"><link rel="prefetch" href="/assets/js/156.f64955fd.js"><link rel="prefetch" href="/assets/js/157.22fb2059.js"><link rel="prefetch" href="/assets/js/158.3f1284f1.js"><link rel="prefetch" href="/assets/js/159.db1a0a87.js"><link rel="prefetch" href="/assets/js/16.20b6666b.js"><link rel="prefetch" href="/assets/js/160.952689a9.js"><link rel="prefetch" href="/assets/js/161.0154148d.js"><link rel="prefetch" href="/assets/js/162.8d2c7b86.js"><link rel="prefetch" href="/assets/js/163.56ab1a17.js"><link rel="prefetch" href="/assets/js/164.51d7be13.js"><link rel="prefetch" href="/assets/js/165.4b4ae73d.js"><link rel="prefetch" href="/assets/js/166.84f5b4f8.js"><link rel="prefetch" href="/assets/js/167.64ffe161.js"><link rel="prefetch" href="/assets/js/17.c2e9a215.js"><link rel="prefetch" href="/assets/js/18.57746ff0.js"><link rel="prefetch" href="/assets/js/19.e636e2f0.js"><link rel="prefetch" href="/assets/js/20.8959fb99.js"><link rel="prefetch" href="/assets/js/21.843f2878.js"><link rel="prefetch" href="/assets/js/22.0260b0a8.js"><link rel="prefetch" href="/assets/js/23.a0ff7a4c.js"><link rel="prefetch" href="/assets/js/24.fc19ac9f.js"><link rel="prefetch" href="/assets/js/25.84c98456.js"><link rel="prefetch" href="/assets/js/26.acb20f2f.js"><link rel="prefetch" href="/assets/js/27.5bb12904.js"><link rel="prefetch" href="/assets/js/28.4361691a.js"><link rel="prefetch" href="/assets/js/29.6eeddad5.js"><link rel="prefetch" href="/assets/js/3.2482c351.js"><link rel="prefetch" href="/assets/js/30.29829b00.js"><link rel="prefetch" href="/assets/js/31.3760ed61.js"><link rel="prefetch" href="/assets/js/32.4842452d.js"><link rel="prefetch" href="/assets/js/33.1f557708.js"><link rel="prefetch" href="/assets/js/34.179bca21.js"><link rel="prefetch" href="/assets/js/35.a1980271.js"><link rel="prefetch" href="/assets/js/36.1e61213c.js"><link rel="prefetch" href="/assets/js/37.caa1a215.js"><link rel="prefetch" href="/assets/js/38.292e7b0d.js"><link rel="prefetch" href="/assets/js/39.8b286afa.js"><link rel="prefetch" href="/assets/js/40.225f31d1.js"><link rel="prefetch" href="/assets/js/41.9d7c6c31.js"><link rel="prefetch" href="/assets/js/42.bcb8e51b.js"><link rel="prefetch" href="/assets/js/43.4d5c1e8d.js"><link rel="prefetch" href="/assets/js/44.fa533f44.js"><link rel="prefetch" href="/assets/js/45.fb5b787d.js"><link rel="prefetch" href="/assets/js/46.9e5b1ed5.js"><link rel="prefetch" href="/assets/js/47.66f52936.js"><link rel="prefetch" href="/assets/js/48.9e8e0eea.js"><link rel="prefetch" href="/assets/js/49.d1a131bd.js"><link rel="prefetch" href="/assets/js/5.a692a018.js"><link rel="prefetch" href="/assets/js/50.0997f7ca.js"><link rel="prefetch" href="/assets/js/51.ba22fc5b.js"><link rel="prefetch" href="/assets/js/52.1a949406.js"><link rel="prefetch" href="/assets/js/53.7e3f7c46.js"><link rel="prefetch" href="/assets/js/54.d554d904.js"><link rel="prefetch" href="/assets/js/55.c158d369.js"><link rel="prefetch" href="/assets/js/56.df00fc74.js"><link rel="prefetch" href="/assets/js/57.53f0ddb3.js"><link rel="prefetch" href="/assets/js/58.07619a0b.js"><link rel="prefetch" href="/assets/js/59.ece1d426.js"><link rel="prefetch" href="/assets/js/6.f2db52e6.js"><link rel="prefetch" href="/assets/js/60.0037383f.js"><link rel="prefetch" href="/assets/js/61.592f5a55.js"><link rel="prefetch" href="/assets/js/62.75c749d7.js"><link rel="prefetch" href="/assets/js/63.3b4a3976.js"><link rel="prefetch" href="/assets/js/64.f27707c1.js"><link rel="prefetch" href="/assets/js/65.465f912d.js"><link rel="prefetch" href="/assets/js/66.7919cd15.js"><link rel="prefetch" href="/assets/js/67.adc0a75a.js"><link rel="prefetch" href="/assets/js/68.a96d0770.js"><link rel="prefetch" href="/assets/js/69.68a7d7fd.js"><link rel="prefetch" href="/assets/js/7.eee03784.js"><link rel="prefetch" href="/assets/js/70.82d609b5.js"><link rel="prefetch" href="/assets/js/71.548aeea0.js"><link rel="prefetch" href="/assets/js/72.3cb4b134.js"><link rel="prefetch" href="/assets/js/73.23f4d7d7.js"><link rel="prefetch" href="/assets/js/74.71a8ee7e.js"><link rel="prefetch" href="/assets/js/75.b612425d.js"><link rel="prefetch" href="/assets/js/76.14e0aa96.js"><link rel="prefetch" href="/assets/js/77.be97536b.js"><link rel="prefetch" href="/assets/js/78.d868e135.js"><link rel="prefetch" href="/assets/js/79.67bf7af8.js"><link rel="prefetch" href="/assets/js/8.10bee0ee.js"><link rel="prefetch" href="/assets/js/80.3cd53a17.js"><link rel="prefetch" href="/assets/js/81.cc766dda.js"><link rel="prefetch" href="/assets/js/82.7c1c4a16.js"><link rel="prefetch" href="/assets/js/83.26d3d54d.js"><link rel="prefetch" href="/assets/js/84.7f6cb376.js"><link rel="prefetch" href="/assets/js/85.a4e85829.js"><link rel="prefetch" href="/assets/js/86.4d8fa898.js"><link rel="prefetch" href="/assets/js/87.84c76a53.js"><link rel="prefetch" href="/assets/js/88.a06aeea2.js"><link rel="prefetch" href="/assets/js/89.5dfd4600.js"><link rel="prefetch" href="/assets/js/9.70045519.js"><link rel="prefetch" href="/assets/js/90.e623bcd0.js"><link rel="prefetch" href="/assets/js/91.bb2cd9f5.js"><link rel="prefetch" href="/assets/js/92.2d2dba4d.js"><link rel="prefetch" href="/assets/js/93.92e36aca.js"><link rel="prefetch" href="/assets/js/94.f5e39a45.js"><link rel="prefetch" href="/assets/js/95.4207a081.js"><link rel="prefetch" href="/assets/js/96.3b4e2da1.js"><link rel="prefetch" href="/assets/js/97.5f195684.js"><link rel="prefetch" href="/assets/js/98.26ac30d7.js"><link rel="prefetch" href="/assets/js/99.831e01fb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.42373c9e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">心谭博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-03-26-javascript-first/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-04-08-react-components-communication/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-08-27-typescript-notes/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-04-09-es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-04-10-html5-drag-drop/" class="nav-link">HTML5</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-15-browser/" class="nav-link">浏览器与安全</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="UI" class="dropdown-title"><span class="title">UI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2018-06-05-border-sizing/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-17-why-i-stopped-using-sass/" class="nav-link">scss</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-07-16-font-animation/" class="nav-link">动画</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-06-23-algorithm-offer/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/passages/2018-10-23-singleton-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-06-21-deep-in-koa/" class="nav-link">Koa</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-07-play-node-shell/" class="nav-link">命令行</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-04-jest-base/" class="nav-link">测试</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-08-14-game-gomoku/" class="nav-link">Serverless</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">文章归档</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-10-02-os-base/" class="nav-link">学习笔记</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2018-07-29-webpack-demos-introduction/" class="nav-link">Webpack4</a></li><li class="dropdown-subitem"><a href="/passages/2018-09-06-git-tag-and-version/" class="nav-link">Git</a></li></ul></li></ul></div></div> <a href="https://github.com/dongyuanxin/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-03-26-javascript-first/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-04-08-react-components-communication/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-08-27-typescript-notes/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-04-09-es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-04-10-html5-drag-drop/" class="nav-link">HTML5</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-15-browser/" class="nav-link">浏览器与安全</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="UI" class="dropdown-title"><span class="title">UI</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2018-06-05-border-sizing/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-17-why-i-stopped-using-sass/" class="nav-link">scss</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-07-16-font-animation/" class="nav-link">动画</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-06-23-algorithm-offer/" class="nav-link">剑指offer</a></li><li class="dropdown-item"><!----> <a href="/passages/2018-10-23-singleton-pattern/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Node" class="dropdown-title"><span class="title">Node</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/passages/2019-06-21-deep-in-koa/" class="nav-link">Koa</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-07-play-node-shell/" class="nav-link">命令行</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-05-04-jest-base/" class="nav-link">测试</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-08-14-game-gomoku/" class="nav-link">Serverless</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">文章归档</a></li><li class="dropdown-item"><!----> <a href="/passages/2019-10-02-os-base/" class="nav-link">学习笔记</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/passages/2018-07-29-webpack-demos-introduction/" class="nav-link">Webpack4</a></li><li class="dropdown-subitem"><a href="/passages/2018-09-06-git-tag-and-version/" class="nav-link">Git</a></li></ul></li></ul></div></div> <a href="https://github.com/dongyuanxin/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/passages/2019-06-10-weekly-share/" class="sidebar-link">介绍</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>2019</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/passages/2019-03-15-weekly-share-3/" class="sidebar-link">新年初刊</a></li><li><a href="/passages/2019-05-25-learn-to-learn/" class="sidebar-link">如何缩小学习反馈周期</a></li><li><a href="/passages/2019-07-06-half-year/" class="sidebar-link">无声半年</a></li><li><a href="/passages/2019-07-12-redis-cache-question/" class="active sidebar-link">redis热key等问题研究</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#主从模式" class="sidebar-link">主从模式</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#哨兵" class="sidebar-link">哨兵</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#穿透" class="sidebar-link">穿透</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#雪崩" class="sidebar-link">雪崩</a></li><li class="sidebar-sub-header"><a href="/passages/2019-07-12-redis-cache-question/#击穿" class="sidebar-link">击穿</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>2018</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/passages/2018-12-08-weekly-share-1/" class="sidebar-link">第一期</a></li><li><a href="/passages/2018-12-24-weekly-share-2/" class="sidebar-link">第二期</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>本篇由来自 <strong>字节跳动</strong> 的 <a href="https://github.com/HuangHongkai" target="_blank" rel="noopener noreferrer">Hongkai<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 分享。</p></blockquote> <p>Redis 主要用途有 2 个</p> <ul><li>数据缓存，减轻 db 的压力</li> <li>数据同步，在分布式系统中各个实例的信息同步</li></ul> <p>redis 的 QPS 量通常相当的大，动辄百万 QPS，一般企业都需要很庞大的 redis 集群资源。由于 redis 的使用相当频繁，经常会出现各种问题。根据目前积累的线上经验，redis 出现问题第一步就是要想到：<strong>redis 是单进程单线程实例</strong> 理解这一点通常能解决很多问题。</p> <p>下面介绍一些 redis 的一些理论知识。</p> <h2 id="主从模式"><a href="#主从模式" class="header-anchor">#</a> 主从模式</h2> <p>将数据分散到多个服务器上，每个服务拥有同样的样本，这样即使有一台服务器出现故障，其他服务器依然可以继续提供服务。为此， Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上。</p> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>在 redis 或 mysql 等数据库中，数据库分为两类，一类是主数据库（master），另一类是从数据库（slave）。主数据库可以进行读写操作，当写操作导致数据变化时会自动将数据同步给从数据库。而从数据库一般是只读的，并接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。</p> <h3 id="复制原理"><a href="#复制原理" class="header-anchor">#</a> 复制原理</h3> <p>当从数据库启动时，会向主数据库发送 sync 命令，主数据库接收到 sync 后开始在后台保存快照 rdb，在保存快照期间受到的命名缓存起来，当快照完成时，主数据库会将快照和缓存的命令一块发送给从。复制初始化结束。之后，主每接收到 1 个命令就同步发送给从。 当出现断开重连后，2.8 之后的版本会将断线期间的命令传给从数据库。</p> <h3 id="优点："><a href="#优点：" class="header-anchor">#</a> 优点：</h3> <ul><li><p>减轻单点压力</p></li> <li><p>提升系统容灾能力</p></li></ul> <h3 id="缺点："><a href="#缺点：" class="header-anchor">#</a> 缺点：</h3> <ul><li>承载的容量非常有限，假设服务器的内存都是 40G，有 10 台服务器，意味着只能容纳 40G 的数据。</li> <li>刚写入的数据可能获取不到（因为数据还没有更新到其他服务器上）</li></ul> <h2 id="哨兵"><a href="#哨兵" class="header-anchor">#</a> 哨兵</h2> <p>在主从模式下，当主服务出现异常会导致整体 redis 不可写。开发者需要手动将一个从数据库升级为主数据库保证服务正常运行。该过程难以自动后，为此在 redis2.8 后提供了哨兵来实现故障恢复功能。</p> <p>哨兵就是 redis 的监控系统，包括 2 个功能</p> <ul><li>监控主数据库和从数据库是否正常运行。</li> <li>主数据库出现故障时自动将从数据库转换为主数据库。</li></ul> <h3 id="主从切换过程"><a href="#主从切换过程" class="header-anchor">#</a> 主从切换过程</h3> <ul><li>slave leader 升级为 master</li> <li>其他 slave 修改为新 master 的 slave</li> <li>客户端修改连接</li> <li>老的 master 如果重启成功，变为新 master 的 slave</li></ul> <h3 id="集群"><a href="#集群" class="header-anchor">#</a> 集群</h3> <p>使用哨兵，redis 每个实例也是全量存储，每个 redis 存储的内容都是完整的数据，浪费内存且有木桶效应。为了最大化利用内存，可以采用集群，即每台机器存储不同的内容。</p> <p>简单来讲：通过不断的扩容和增加运行 redis 实例的机器数量，使得 redis 能撑得住更大的访问量</p> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>redis cluster 中有一个 16384（2^4 * 2^10）长度的槽的概念。通过哈希算法再加上取模运算可以将一个值固定地映射到某个区间，区间由连续的 slot 组成。</p> <p>redis cluster 采用虚拟槽分区，所有的键根据哈希函数(CRC16[key]&amp;16383)映射到 0－16383 槽内，共 16384 个槽位，每个节点维护部分槽及槽所映射的键值数据，可以为节点设置权重，权重高的节点维护的槽的数量比较多。</p> <p>哈希函数: Hash()=CRC16[key]&amp;16383 按位与</p> <p>redis 用虚拟槽分区原因：解耦数据与节点关系，节点自身维护槽映射关系，分布式存储</p> <h3 id="集群模式"><a href="#集群模式" class="header-anchor">#</a> 集群模式</h3> <ul><li>客户端模式</li></ul> <p>在客户端做 redis 负载均衡，通过服务发现注册 redis 节点，实现 redis 节点的动态改变（增删或者节点扩容）</p> <p><img src="https://i.loli.net/2019/07/12/5d27764947bf559054.png" alt="img"></p> <p>优点</p> <ul><li>数据分散，使得整体容量得到提升</li> <li>当一个节点不可用不会导致整体服务不可用</li> <li>性能高，客户端直接连接 redis，不通过代理</li> <li>扩容方便</li></ul> <p>目前企业使用的 redis 集群基本都是客户端模式，这样可以减轻服务端的压力。</p> <ul><li>代理模式</li></ul> <p>客户端不是直接连接 redis，而是连接代理，这样子客户端的开发就变得简单很多了。。同时服务端也可以控制 redis 的连接数。</p> <p><img src="https://i.loli.net/2019/07/12/5d27764e1a87934952.png" alt="img"></p> <h3 id="分析"><a href="#分析" class="header-anchor">#</a> 分析</h3> <p>集群模式的解决了容量的问题，但是带来了很多的问题，例如 redis 的热 key 问题，单点高并发会导致 redis 负载及其不均衡，进而服务可用性极低。</p> <h2 id="穿透"><a href="#穿透" class="header-anchor">#</a> 穿透</h2> <h3 id="缓存的处理流程"><a href="#缓存的处理流程" class="header-anchor">#</a> 缓存的处理流程</h3> <p><img src="https://i.loli.net/2019/07/12/5d277651adee639077.png" alt="img"></p> <h3 id="缓存穿透"><a href="#缓存穿透" class="header-anchor">#</a> 缓存穿透</h3> <p>频繁查询一个不存在的数据，由于缓存不命中，每次都要查询持久层。从而失去缓存的意义。</p> <p>如果恶意用户知道我们 redis key 的构造规则，每次故意查询一个在缓存内必然不存在的数据，导致每次请求都要去存储层去查询，这样缓存就失去了意义。如果在高并发下数据库可能挂掉。这就是<strong>缓存击穿</strong>。</p> <h2 id="雪崩"><a href="#雪崩" class="header-anchor">#</a> 雪崩</h2> <p>redis 缓存大量失效的时候，引发大量查询数据库。如果有的数据只放在 redis 上（例如用来同步多个服务实例信息之间的共享数据），redis 缓存失效会导致服务出现异常，这比查数据库更加严重</p> <p>引起这个问题的原因主要是 redis 单点被打垮，也就是热 key 问题。</p> <h2 id="击穿"><a href="#击穿" class="header-anchor">#</a> 击穿</h2> <p>缓存击穿是指缓存中没有但数据库中有的数据（一般是缓存时间到期），这时由于并发用户特别多，同时读缓存没读到数据，又同时去数据库去取数据，引起数据库压力瞬间增大，造成过大压力</p> <p>解决方案：</p> <ul><li>设置频繁访问的数据过期（让缓存持续命中）</li> <li>加分布式锁（如果缓存不存在，只让一个进程去读 db，有点类似于单例模式的实现，下面是一个从网上找的小 demo）</li></ul> <p><img src="https://i.loli.net/2019/07/12/5d277650ad21c42141.png" alt="img"></p> <h3 id="热-key"><a href="#热-key" class="header-anchor">#</a> 热 key</h3> <p>在集群模式下经常会遇到这个问题，业界依然没有好的解决方案（参见微博只要热点事件就垮了）</p> <p>热 key：某个 key 访问非常的频繁，<strong>redis 集群负载不均衡，导致单点延迟增加，从而导致单点 redis 上的缓存不可用。</strong></p> <p>这个问题相当的难以解决，微博在出现热点事件后服务不可用，很大原因是热 key 问题，导致单点 redis 被打垮了， 增加 db 访问量，进而系统雪崩。</p> <p>因为<strong>redis 是单进程单线程</strong> ，redis 的处理线程忙起来，会导致 redis 没空 accept 来自 client 的 tcp 请求，进而出现连接超时的错误，缓存未命中。</p> <h3 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h3> <p>没有具体的解决方案，需要根据业务来制定。思路<strong>将 key 打散</strong>，就是将 redis 访问某个热 key，转化为访问多个 key，减轻单点压力</p> <p>但并不是所有的业务都能使用该解决方案。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dongyuanxin/blog/edit/master/docs/每周分享/01.2019/04.redis热key等问题研究.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">9/19/2019, 6:41:46 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/passages/2019-07-06-half-year/" class="prev">无声半年</a></span> <span class="next"><a href="/passages/2018-12-08-weekly-share-1/">第一期</a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="my-loader center" style="display:none;" data-v-354e1a9e><div class="my-loader-circle" data-v-354e1a9e></div></div><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div><!----><!----><div></div></div></div>
    <script src="/assets/js/app.9d47bfcf.js" defer></script><script src="/assets/js/2.f2881f60.js" defer></script><script src="/assets/js/127.5e49c169.js" defer></script><script src="/assets/js/4.6561383e.js" defer></script>
  </body>
</html>
